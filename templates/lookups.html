{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">مدیریت لیست‌های کرکره‌ای</h5>
    <a href="{{ url_for('add_lookup') }}" class="btn btn-primary btn-sm">افزودن آیتم</a>
  </div>

  <form class="mb-3" method="get">
    <label class="form-label">گروه</label>
    <select name="group" class="form-select" onchange="this.form.submit()">
      <option value="department" {% if group=='department' %}selected{% endif %}>واحد/اداره</option>
      <option value="office" {% if group=='office' %}selected{% endif %}>سازمان/اداره</option>
      <option value="vendor" {% if group=='vendor' %}selected{% endif %}>سازنده/فروشنده</option>
    </select>
  </form>

  <div class="card">
    <div class="table-responsive">
      <table class="table table-striped mb-0">
        <thead>
          <tr>
            <th>#</th>
            <th>کلید</th>
            <th>برچسب</th>
            <th>ترتیب</th>
            <th>وضعیت</th>
            <th class="text-end">عملیات</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
          <tr>
            <td>{{ it.id }}</td>
            <td>{{ it.key }}</td>
            <td>{{ it.label }}</td>
            <td>{{ it.order }}</td>
            <td>
              <span class="badge {% if it.is_active %}bg-success{% else %}bg-secondary{% endif %}">{{ 'فعال' if it.is_active else 'غیرفعال' }}</span>
            </td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-secondary" onclick="toggleItem({{ it.id }})">تغییر وضعیت</button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteItem({{ it.id }})">حذف</button>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="6" class="text-center py-4 text-muted">آیتمی ثبت نشده</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
function toggleItem(id){
  fetch(`/lookups/${id}/toggle`, {method:'POST', headers:{'X-CSRFToken': '{{ csrf_token() }}'}})
    .then(r=>r.json()).then(()=>location.reload());
}
function deleteItem(id){
  if(!confirm('حذف شود؟')) return;
  fetch(`/lookups/${id}/delete`, {method:'POST', headers:{'X-CSRFToken': '{{ csrf_token() }}'}})
    .then(r=>r.json()).then(()=>location.reload());
}
</script>
{% endblock %}


