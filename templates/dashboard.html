{% extends 'base.html' %}
{% block page_title %}Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯{% endblock %}
{% block content %}
<!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card bg-gradient-primary text-white">
      <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h3 class="mb-2">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ {{ current_user.username }}! ğŸ‘‹</h3>
            <p class="mb-0 opacity-75">Ø§Ù…Ø±ÙˆØ² Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯ØŸ</p>
          </div>
          <div class="text-end">
            <div class="fs-6 opacity-75" id="current-date"></div>
            <div class="fs-5 fw-bold" id="current-time"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
<div class="row mb-4">
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card stats-card stats-primary hover-lift">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="stats-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="flex-grow-1">
            <h3 class="stats-number counter" data-target="{{ stats.users_count }}">0</h3>
            <p class="stats-label">Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</p>
            <small class="stats-change text-success">
              <i class="fas fa-arrow-up"></i> +12% Ø§Ø² Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card stats-card stats-success hover-lift">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="stats-icon">
            <i class="fas fa-server"></i>
          </div>
          <div class="flex-grow-1">
            <h3 class="stats-number counter" data-target="{{ stats.servers_count }}">0</h3>
            <p class="stats-label">Ø³Ø±ÙˆØ±Ù‡Ø§</p>
            <small class="stats-change text-success">
              <i class="fas fa-arrow-up"></i> +3 Ø§ÛŒÙ† Ù…Ø§Ù‡
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card stats-card stats-warning hover-lift">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="stats-icon">
            <i class="fas fa-tasks"></i>
          </div>
          <div class="flex-grow-1">
            <h3 class="stats-number counter" data-target="{{ stats.tasks_count }}">0</h3>
            <p class="stats-label">ØªØ³Ú©â€ŒÙ‡Ø§</p>
            <small class="stats-change text-warning">
              <i class="fas fa-clock"></i> {{ stats.active_tasks }} ÙØ¹Ø§Ù„
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card stats-card stats-info hover-lift">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="stats-icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="flex-grow-1">
            <h3 class="stats-number counter" data-target="{{ stats.content_count }}">0</h3>
            <p class="stats-label">Ù…Ø­ØªÙˆØ§</p>
            <small class="stats-change text-success">
              <i class="fas fa-check"></i> {{ stats.published_content }} Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± -->
<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
          <i class="fas fa-tasks text-primary"></i> ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
        </h6>
        <a href="{{ url_for('tasks') }}" class="btn btn-sm btn-outline-primary">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡</a>
      </div>
      <div class="card-body p-0">
        {% if recent_tasks %}
          {% for task in recent_tasks %}
            <div class="activity-item activity-{{ 'success' if task.status == 'completed' else 'warning' if task.status == 'in_progress' else 'primary' }}">
              <div class="d-flex align-items-center">
                <div class="activity-icon">
                  <i class="fas fa-{{ 'check' if task.status == 'completed' else 'clock' if task.status == 'in_progress' else 'circle' }}"></i>
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">{{ task.title }}</h6>
                  <small class="text-muted">
                    <i class="fas fa-calendar"></i> {{ task.created_at.strftime('%Y/%m/%d %H:%M') }}
                    {% if task.assigned_user %}
                      | <i class="fas fa-user"></i> {{ task.assigned_user.username }}
                    {% endif %}
                  </small>
                </div>
                <div>
                  <span class="badge bg-{{ 'success' if task.status == 'completed' else 'warning' if task.status == 'in_progress' else 'secondary' }}">
                    {{ task.status }}
                  </span>
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-center py-4">
            <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
            <p class="text-muted">Ù‡ÛŒÚ† ØªØ³Ú©ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
            <a href="{{ url_for('add_task') }}" class="btn btn-primary btn-sm">ØªØ³Ú© Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
          <i class="fas fa-file-alt text-info"></i> Ù…Ø­ØªÙˆØ§ÛŒ Ø§Ø®ÛŒØ±
        </h6>
        <a href="{{ url_for('content') }}" class="btn btn-sm btn-outline-primary">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡</a>
      </div>
      <div class="card-body p-0">
        {% if recent_content %}
          {% for content in recent_content %}
            <div class="activity-item activity-{{ 'success' if content.status == 'published' else 'warning' if content.status == 'draft' else 'info' }}">
              <div class="d-flex align-items-center">
                <div class="activity-icon">
                  <i class="fas fa-{{ 'check-circle' if content.status == 'published' else 'edit' if content.status == 'draft' else 'archive' }}"></i>
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">{{ content.title }}</h6>
                  <small class="text-muted">
                    <i class="fas fa-calendar"></i> {{ content.created_at.strftime('%Y/%m/%d %H:%M') }}
                    | <i class="fas fa-user"></i> {{ content.author.username }}
                  </small>
                </div>
                <div>
                  <span class="badge bg-{{ 'success' if content.status == 'published' else 'warning' if content.status == 'draft' else 'secondary' }}">
                    {{ content.status }}
                  </span>
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-center py-4">
            <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
            <p class="text-muted">Ù‡ÛŒÚ† Ù…Ø­ØªÙˆØ§ÛŒÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
            <a href="{{ url_for('add_content') }}" class="btn btn-primary btn-sm">Ù…Ø­ØªÙˆØ§ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹ -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">
          <i class="fas fa-bolt text-warning"></i> Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('add_task') }}" class="quick-action">
              <div class="quick-action-icon">
                <i class="fas fa-plus"></i>
              </div>
              <h6>ØªØ³Ú© Ø¬Ø¯ÛŒØ¯</h6>
              <p>Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</p>
            </a>
          </div>
          
          <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('add_content') }}" class="quick-action">
              <div class="quick-action-icon">
                <i class="fas fa-file-alt"></i>
              </div>
              <h6>Ù…Ø­ØªÙˆØ§ Ø¬Ø¯ÛŒØ¯</h6>
              <p>Ø§ÛŒØ¬Ø§Ø¯ ØµÙØ­Ø§Øª Ùˆ Ù…Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÛŒØ¯</p>
            </a>
          </div>
          
          <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('add_server') }}" class="quick-action">
              <div class="quick-action-icon">
                <i class="fas fa-server"></i>
              </div>
              <h6>Ø³Ø±ÙˆØ± Ø¬Ø¯ÛŒØ¯</h6>
              <p>Ø«Ø¨Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</p>
            </a>
          </div>
          
          <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('add_user') }}" class="quick-action">
              <div class="quick-action-icon">
                <i class="fas fa-user-plus"></i>
              </div>
              <h6>Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h6>
              <p>Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯</p>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† ÙˆØ§Ù‚Ø¹ÛŒ
function updateDateTime() {
  const now = new Date();
  
  // Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®
  const dateOptions = {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  };
  const dateString = now.toLocaleDateString('fa-IR', dateOptions);
  document.getElementById('current-date').textContent = dateString;
  
  // Ù†Ù…Ø§ÛŒØ´ Ø²Ù…Ø§Ù†
  const timeOptions = {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  };
  const timeString = now.toLocaleTimeString('fa-IR', timeOptions);
  document.getElementById('current-time').textContent = timeString;
}

// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø± Ø«Ø§Ù†ÛŒÙ‡
setInterval(updateDateTime, 1000);
updateDateTime(); // Ø§Ø¬Ø±Ø§ÛŒ ÙÙˆØ±ÛŒ

// Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÙ‡Ø§
function animateCounters() {
  const counters = document.querySelectorAll('.stats-number');
  
  counters.forEach(counter => {
    const target = parseInt(counter.textContent);
    const duration = 2000; // 2 Ø«Ø§Ù†ÛŒÙ‡
    const increment = target / (duration / 16); // 60 FPS
    let current = 0;
    
    const timer = setInterval(() => {
      current += increment;
      if (current >= target) {
        current = target;
        clearInterval(timer);
      }
      counter.textContent = Math.floor(current);
    }, 16);
  });
}

// Ø§Ø¬Ø±Ø§ÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
document.addEventListener('DOMContentLoaded', animateCounters);

// Ø§Ù†ÛŒÙ…ÛŒØ´Ù† hover Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
document.querySelectorAll('.stats-card').forEach(card => {
  card.addEventListener('mouseenter', function() {
    this.style.transform = 'translateY(-8px) scale(1.02)';
  });
  
  card.addEventListener('mouseleave', function() {
    this.style.transform = 'translateY(0) scale(1)';
  });
});
</script>
{% endblock %}
